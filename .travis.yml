sudo: required
dist: trusty
services: docker
language: minimal
cache:
  directories:
  - node_modules
  - "$HOME/.cache/electron"
  - "$HOME/.cache/electron-builder"
script: |
  docker run --rm \
    --env-file <(env | grep -v '\r' | grep -iE 'DEBUG|NODE_|ELECTRON_|YARN_|NPM_|CI|CIRCLE|TRAVIS|APPVEYOR_|CSC_|_TOKEN|_KEY|AWS_|STRIP|BUILD_') \
    -v ${PWD}:/project \
    -v ~/.cache/electron:/root/.cache/electron \
    -v ~/.cache/electron-builder:/root/.cache/electron-builder \
    electronuserland/builder \
    /bin/bash -c "yarn --link-duplicates --pure-lockfile && yarn dist:linux"
deploy:
  - provider: releases
    api_key:
      secure: iDQ43pycfmaBA84tTCHLHHzniaHQS1blTlISLpiFzZNZtqxWuS8i8VIxitq9UQ2vuUthKx5o7pubhkD8CxspHp5YNuqTmraUu8Zy6BdZIC2bzp4gjUJNYtSxeL1cpxF3NO+EzmSh8jO8289KQVTlC+4MA6JBCxS4psLy5BpSzQoi7Evn7iDYHI3nbtV9Xw9GhhBpH3N5jzv6+Nvm8VlIHCDPXlzcqf4iEg+u7r2hoXXAKR4kcsFREDj95KVbiB+NUciKLNixMJbWGD1sKEzi1JFcgrtnRiWmbGr1fRdlAyEW6PrDvu4xmKHQayV5GC9FSTtAp86n26VNtGwz64mpsZWlbRQNvINRWXBX/nM8Rqxs/LgiXirR8x7K23/Gp4DjGKUFYzM+jUQIx4ha+CmlpjwTvxAT13dfWNsDX6VPTjWtkIcZ3ypXlAYRa2mwHV4/NskJUStw3Aqya6ovhBwzTYY+NQioJOHVnSwL+Sk2092SITgqbHKpxUkfQzbVCiiWJtIfvYGpDTxdEFogPEMX4zyjNO/UCc98MaD6MxKJLlva4NpqjnMpdKbwrHZtptt6VV8GhYqhAwZ+TepSMObUhl/I+P2G8dvfZu5eMSmokYGQmVKUKzfMXMY91/AUyxWumPSWPnREdaM+UvNZ1Hevnx8DdywDJzp1gN/GwJK9hcE=
    file: dist/*.*
    draft: true
    on:
      branch: develop || travis-changes
  - provider: snap
    snap: teams-for-linux
    on:
      branch: develop || travis-changes
      channel: edge
branches:
  except:
  - "/^v\\d+\\.\\d+\\.\\d+$/"
